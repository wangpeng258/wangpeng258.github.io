<!DOCTYPE html>
<html lang="en">

    <head>
        <title>Lipstick</title>
        <meta name="viewport" content="width=device-width, viewport-fit=cover">
        <link href="https://cdn.bootcdn.net/ajax/libs/vant/2.12.25/index.min.css" rel="stylesheet">
        <script src="https://dcdn.it120.cc/2022/12/09/89f2df97-9b7c-4650-9cce-7d885642564b.js"></script>
        <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.min.js"></script>
        <script src="https://cdn.bootcdn.net/ajax/libs/vant/2.12.25/vant.min.js"></script>
        <script src="https://cdn.bootcdn.net/ajax/libs/tensorflow/3.19.0/tf.min.js"></script>
        <script src="https://unpkg.com/@mediapipe/face_mesh"></script>
        <script src="https://unpkg.com/@tensorflow-models/face-landmarks-detection"></script>
        <!-- <script src="https://unpkg.com/kalidokit/dist/kalidokit.umd.js"></script> -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <style>
            * {
                padding: 0;
                margin: 0;
            }

            html,
            body,
            #app {
                width: 100%;
                height: 100%;
                overflow: hidden;
                background-color: #000;
            }

            [v-cloak] {
                opacity: 0 !important;
            }

            .canvas-wrapper {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                max-width: 600px;
                margin: 0 auto;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }



            .canvas-wrapper>canvas {
                display: block;
                width: 100%;
                position: absolute;
                top: 50%;
                left: 50%;
                z-index: 1;
                transform: translate(-50%, -50%) scale(1, 1);
            }
            .canvas-wrapper>video {
                background: #000;
                display: block;
                width: 100%;
                height: 100%;
                position: absolute;
                top:0;
                left:0;
                object-fit: cover;
            }
            .canvas-wrapper>.video{
                z-index: 2;
            }
            .canvas-wrapper>.previewVideo{
                z-index: 3;
            }
            select.van-field__control {
                -webkit-appearance: none;
                border: 0;
                outline: 0;
                vertical-align: bottom;
                box-sizing: border-box;
                font-size: 12px;
            }
            .form-wrapper{
                position: fixed;
                left:0;
                bottom:0;
                width:100%;
                height:30vh;
                background-color: rgba(0, 0, 0, 0.4);
                color: rgba(255, 255, 255, 0.8);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                transition: transform 0.3s;
            }
            .form-wrapper .van-cell{
                background-color:transparent;
            }
            .form-wrapper .van-field__label{
                color: rgba(255, 255, 255, 0.9);
                width: 3em;
            }
            .form-wrapper .van-field__control{
                color: rgba(255, 255, 255, 0.7);
            }
            .form-wrapper .van-cell::after{
                border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            }
            .lipstick-brands{
                margin-bottom: 10px;
            }
            .lipstick-brands-name{
                font-size:15px;
                font-weight: bold;
                color: rgba(255, 255, 255, 0.7);
            }
            .lipstick-brands-series-name{
                font-size:12px;
                font-weight: 300;
                color: rgba(255, 255, 255, 0.5);
                margin-bottom: 5px;
            }
            @media screen and (max-width: 785px) {
                .lipstick-brands-series-lipsticks{
                    overflow-y: auto;
                    white-space:nowrap;
                }
            }
            .lipstick-color{
                display: inline-block;
                width: 40px;
                height: 40px;
                border-radius: 100px;
                text-align: center;
                line-height: 40px;
                font-size: 12px;
                margin: 0 10px 10px 0;
                cursor: pointer;
                border: 3px solid transparent;
                transition: all 0.35s;
                box-sizing: border-box;
            }
            .lipstick-color-active{
                border-color: white;
            }
            .fixedButton{
                position: fixed;
                right:0;
                bottom:32vh;
                z-index:10;
                display: flex;
                flex-direction: column-reverse;
            }
            .fixedButton .van-button::before{
                display: none;
            }
            .fixedButton .van-button{
                background-color: rgba(0, 0, 0, 0.7);
                border-color:#fff;
                color:#fff;
                margin: 5px;
                font-size: 13px;
                padding: 0;
                width: 40px;
                height: 40px;
                line-height: 40px;
                opacity: 0.8;
            }
            .helpdialog .van-dialog__message {
                line-height: 1;
                white-space: unset;
            }
            .prompt-text {
                font-size: 18px;
                padding: 15px;
                color: #000;
            }

            .prompt-text>h5 {
                opacity: 0.9;
                padding-bottom: 1em;
            }

            .prompt-text>ol {
                text-align: left;
                opacity: 0.8;
                list-style: revert;
                font-size: 13px;
                line-height: 1.7;
                padding-left: 1em;
            }
        </style>
    </head>

    <body>
        <div id="app" v-cloak>
            <div class="canvas-wrapper" ref="wrapper">
                <canvas ref="canvas" :width="canvasWidth" :height="canvasHeight"></canvas>
                <video ref="video"
                    class="video"
                    :style="{ 'transform': controls.flipHorizontal ? 'scale(-1, 1)' : 'scale(1, 1)' }"
                    webkit-playsinline="true" playsinline="true" preload autoplay loop muted></video>
                <video ref="previewVideo"
                    class="previewVideo"
                    webkit-playsinline="true" playsinline="true" preload autoplay loop muted></video>
            </div>
            <div class="form-wrapper">
                <van-form @submit.native.prevent>
                    <van-field label="摄像头" center is-link>
                        <template #input>
                            <select class="van-field__control" v-model="controls.deviceId" @change="actionSelect">
                                <option v-for="(item,index) in deviceList" :key="index"
                                    :value="item.deviceId" v-text="item.name"></option>
                            </select>
                        </template>
                    </van-field>
                    <van-field label="镜像" center>
                        <template #input>
                            <input type="checkbox" v-model="controls.flipHorizontal" size="15" @change="createModel">
                        </template>
                    </van-field>
                    <van-field label="颜色">
                        <template #input>
                            <div style="flex: 1;width: 0;">
                                <div class="lipstick-brands" v-for="(item,index) in brands" :key="item.name+index">
                                    <div class="lipstick-brands-name" v-text="item.name"></div>
                                    <div class="lipstick-brands-series" v-for="(seriesItem,seriesIndex) in item.series" :key="seriesItem.name+seriesIndex">
                                        <div class="lipstick-brands-series-name" v-text="seriesItem.name"></div>
                                        <div class="lipstick-brands-series-lipsticks">
                                            <div class="lipstick-color van-ellipsis"
                                            v-for="(lipsticksItem,lipsticksIndex) in seriesItem.lipsticks"
                                            :key="lipsticksItem.id" :style="{'background-color'
                                            :lipsticksItem.color}" :title="lipsticksItem.name"
                                            @click="setColor(item,seriesItem,lipsticksItem)"
                                            :class="{'lipstick-color-active':lipsColorId===lipsticksItem.id}"
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </van-field>
                    <van-field label="自定义" center>
                        <template #input>
                            <input type="color" v-model="controls.lipsColor">
                        </template>
                    </van-field>
                    <van-field label="透明度" center>
                        <template #input>
                            <input type="range" min="0.1" max="1" step="0.1" v-model="controls.lipsOpacity">
                        </template>
                    </van-field>
                </van-form>
            </div>

            <div class="fixedButton">
                <van-button @click="share" v-if="(typeof navigator.share)!='undefined'" round icon="share" native-type="button"></van-button>
                <van-button @click="downloadImg" round icon="photograph" native-type="button"></van-button>
            </div>
        </div>
        <script>
           const brands = [
        {
            "name": "圣罗兰",
            "series": [
                {
                    "name": "莹亮纯魅唇膏",
                    "lipsticks": [
                        {
                            "color": "#D62352",
                            "id": "49",
                            "name": "撩骚"
                        },
                        {
                            "color": "#DC4B41",
                            "id": "14",
                            "name": "一见倾心"
                        },
                        {
                            "color": "#B22146",
                            "id": "05",
                            "name": "浮生若梦"
                        },
                        {
                            "color": "#A25356",
                            "id": "08",
                            "name": "纯真梦幻"
                        },
                        {
                            "color": "#DF3443",
                            "id": "12",
                            "name": "红粉派对"
                        },
                        {
                            "color": "#E06C68",
                            "id": "15",
                            "name": "珊瑚恋人"
                        },
                        {
                            "color": "#842C71",
                            "id": "19",
                            "name": "华丽转身"
                        },
                        {
                            "color": "#D13C4F",
                            "id": "43",
                            "name": "唇印"
                        },
                        {
                            "color": "#B71D32",
                            "id": "04",
                            "name": "危情禁果"
                        },
                        {
                            "color": "#DE2361",
                            "id": "06",
                            "name": "情窦初开"
                        },
                        {
                            "color": "#B05856",
                            "id": "09",
                            "name": "裸色暗恋"
                        },
                        {
                            "color": "#E06F70",
                            "id": "13",
                            "name": "邂逅巴黎"
                        },
                        {
                            "color": "#CD4143",
                            "id": "16",
                            "name": "糖果女孩"
                        },
                        {
                            "color": "#EC6A70",
                            "id": "41",
                            "name": "告白"
                        },
                        {
                            "color": "#EFE9DE",
                            "id": "42",
                            "name": "初恋"
                        },
                        {
                            "color": "#C60F2F",
                            "id": "45",
                            "name": "拥吻"
                        },
                        {
                            "color": "#BB6868",
                            "id": "47",
                            "name": "心跳"
                        },
                        {
                            "color": "#E0186B",
                            "id": "50",
                            "name": "约定"
                        },
                        {
                            "color": "#D45E85",
                            "id": "52",
                            "name": "游戏"
                        },
                        {
                            "color": "#C16E6F",
                            "id": "44",
                            "name": "意外"
                        },
                        {
                            "color": "#D1121B",
                            "id": "46",
                            "name": "钟情"
                        },
                        {
                            "color": "#8E243E",
                            "id": "48",
                            "name": "夜色"
                        },
                        {
                            "color": "#EE7486",
                            "id": "51",
                            "name": "私语"
                        }
                    ]
                },
                {
                    "name": "纯口红",
                    "lipsticks": [
                        {
                            "id": "19",
                            "color": "#B13C79",
                            "name": "玫红色"
                        },
                        {
                            "id": "13",
                            "color": "#BB1813",
                            "name": "正橘色"
                        },
                        {
                            "id": "52",
                            "color": "#EA4E59",
                            "name": "星星色"
                        },
                        {
                            "id": "01",
                            "color": "#B8122B",
                            "name": "正红色"
                        },
                        {
                            "id": "17",
                            "color": "#F75E70",
                            "name": "嫣粉纱丽"
                        },
                        {
                            "id": "07",
                            "color": "#CB2276",
                            "name": "雅紫纱蓉"
                        },
                        {
                            "id": "09",
                            "color": "#C27482",
                            "name": "绛紫丝绒"
                        },
                        {
                            "id": "11",
                            "color": "#C06B72",
                            "name": "藕粉云罗"
                        },
                        {
                            "id": "16",
                            "color": "#BB444A",
                            "name": "绯红香缎"
                        },
                        {
                            "id": "22",
                            "color": "#E86E9F",
                            "name": "莹亮裸粉"
                        },
                        {
                            "id": "23",
                            "color": "#DE6F5C",
                            "name": "杏色府绸"
                        },
                        {
                            "id": "26",
                            "color": "#CC6D84",
                            "name": "堇色流纱"
                        },
                        {
                            "id": "36",
                            "color": "#ED695D",
                            "name": "珊瑚雪纺"
                        },
                        {
                            "id": "49",
                            "color": "#DC4D8D",
                            "name": "想你色"
                        },
                        {
                            "id": "51",
                            "color": "#FA6C55",
                            "name": "莹亮珊瑚橙"
                        },
                        {
                            "id": "56",
                            "color": "#D9100E",
                            "name": "橙红织锦"
                        },
                        {
                            "id": "59",
                            "color": "#B96463",
                            "name": "裸色薄纱"
                        },
                        {
                            "id": "207",
                            "color": "#CA4061",
                            "name": "珊瑚柚"
                        },
                        {
                            "id": "208",
                            "color": "#D60846",
                            "name": "玫红色"
                        },
                        {
                            "id": "27",
                            "color": "#D24379",
                            "name": "纯真玫红"
                        },
                        {
                            "id": "50",
                            "color": "#DC2923",
                            "name": "前卫霓红"
                        },
                        {
                            "id": "57",
                            "color": "#C7153D",
                            "name": "明亮裸唇"
                        },
                        {
                            "id": "58",
                            "color": "#B25D84",
                            "name": "明亮淡紫"
                        },
                        {
                            "id": "201",
                            "color": "#B01020",
                            "name": "红唇印象"
                        },
                        {
                            "id": "202",
                            "color": "#9E2C2C",
                            "name": "疯狂玫瑰"
                        },
                        {
                            "id": "203",
                            "color": "#940220",
                            "name": "摇滚红唇"
                        },
                        {
                            "id": "205",
                            "color": "#550001",
                            "name": "天然浆果"
                        },
                        {
                            "id": "72",
                            "color": "#9A1B2F",
                            "name": ""
                        },
                        {
                            "id": "73",
                            "color": "#CF0410",
                            "name": ""
                        },
                        {
                            "id": "74",
                            "color": "#E0291B",
                            "name": ""
                        },
                        {
                            "id": "211",
                            "color": "#E4004F",
                            "name": "DECADENT"
                        },
                        {
                            "id": "212",
                            "color": "#A53B4F",
                            "name": "ALTERNATIVEPLUM"
                        },
                        {
                            "id": "213",
                            "color": "#E94138",
                            "name": "ORANGE SEVENTIES"
                        },
                        {
                            "id": "215",
                            "color": "#E34E90",
                            "name": "LUST FOR PINK"
                        },
                        {
                            "id": "216",
                            "color": "#DE455A",
                            "name": "RED CLASH"
                        },
                        {
                            "id": "217",
                            "color": "#DE455A",
                            "name": "NUDE TROUBLE"
                        }
                    ]
                },
                {
                    "name": "莹亮纯魅美唇膏",
                    "lipsticks": [
                        {
                            "id": "11",
                            "color": "#D51768",
                            "name": "玫色游戏"
                        },
                        {
                            "id": "3",
                            "color": "#F18885",
                            "name": "玫瑰轻语"
                        },
                        {
                            "id": "8",
                            "color": "#E52322",
                            "name": "橙色放纵"
                        },
                        {
                            "id": "4",
                            "color": "#DA0140",
                            "name": "桃红欲望"
                        },
                        {
                            "id": "1",
                            "color": "#C05B60",
                            "name": "裸色幻想"
                        },
                        {
                            "id": "2",
                            "color": "#E87593",
                            "name": "粉色嬉戏"
                        },
                        {
                            "id": "5",
                            "color": "#630F28",
                            "name": "梅色撩拨"
                        },
                        {
                            "id": "6",
                            "color": "#CC0824",
                            "name": "红色触碰"
                        },
                        {
                            "id": "7",
                            "color": "#ED6D68",
                            "name": "珊瑚挑逗"
                        },
                        {
                            "id": "9",
                            "color": "#E73458",
                            "name": "粉色纵情"
                        },
                        {
                            "id": "10",
                            "color": "#A00F30",
                            "name": "绯红诱惑"
                        },
                        {
                            "id": "12",
                            "color": "#B81D3D",
                            "name": "苺色暧昧"
                        }
                    ]
                },
                {
                    "name": "纯色唇釉叛逆裸唇",
                    "lipsticks": [
                        {
                            "id": "12",
                            "color": "#D0011E",
                            "name": "红绯"
                        },
                        {
                            "id": "46",
                            "color": "#9F182C",
                            "name": "深红色"
                        },
                        {
                            "id": "50",
                            "color": "#C64E5B",
                            "name": "自然珊瑚"
                        },
                        {
                            "id": "08",
                            "color": "#C41304",
                            "name": "唐橘"
                        },
                        {
                            "id": "07",
                            "color": "#CC2010",
                            "name": "蜜柚"
                        },
                        {
                            "id": "09",
                            "color": "#D4020E",
                            "name": "红釉"
                        },
                        {
                            "id": "11",
                            "color": "#D0010B",
                            "name": "洋红"
                        },
                        {
                            "id": "13",
                            "color": "#CC030E",
                            "name": "茜色"
                        },
                        {
                            "id": "15",
                            "color": "#D41B40",
                            "name": "桃红"
                        },
                        {
                            "id": "42",
                            "color": "#DF294E",
                            "name": "风情橘红"
                        },
                        {
                            "id": "43",
                            "color": "#E23E44",
                            "name": "玫瑰歌谣"
                        },
                        {
                            "id": "47",
                            "color": "#BC3250",
                            "name": "桃红色"
                        },
                        {
                            "id": "48",
                            "color": "#C13E30",
                            "name": "橙色"
                        },
                        {
                            "id": "49",
                            "color": "#BB325C",
                            "name": "梅子色"
                        },
                        {
                            "id": "51",
                            "color": "#951E53",
                            "name": "玫红色"
                        },
                        {
                            "id": "200",
                            "color": "#DC9F8F",
                            "name": "丰唇唇釉"
                        }
                    ]
                },
                {
                    "name": "莹亮绚染唇油",
                    "lipsticks": [
                        {
                            "id": "05",
                            "color": "#FF54A3",
                            "name": "樱桃情人"
                        },
                        {
                            "id": "04",
                            "color": "#FF725D",
                            "name": "粉恋玫瑰"
                        },
                        {
                            "id": "06",
                            "color": "#C072B5",
                            "name": "蜜桃热恋"
                        },
                        {
                            "id": "07",
                            "color": "#FFD0DD",
                            "name": "橙色邂逅"
                        },
                        {
                            "id": "08",
                            "color": "#FF7B1E",
                            "name": "粉色憧憬"
                        }
                    ]
                },
                {
                    "name": "甜吻唇颊霜",
                    "lipsticks": [
                        {
                            "id": "05",
                            "color": "#E21949",
                            "name": "洋红色"
                        },
                        {
                            "id": "01",
                            "color": "#DD2269",
                            "name": "玫红色"
                        },
                        {
                            "id": "02",
                            "color": "#E05572",
                            "name": "樱花粉"
                        },
                        {
                            "id": "03",
                            "color": "#D16479",
                            "name": "裸粉色"
                        },
                        {
                            "id": "04",
                            "color": "#DF4A43",
                            "name": "亮橘色"
                        },
                        {
                            "id": "07",
                            "color": "#DC6B5D",
                            "name": "珊瑚橙"
                        },
                        {
                            "id": "08",
                            "color": "#DE6A78",
                            "name": "珊瑚粉"
                        },
                        {
                            "id": "09",
                            "color": "#BF7083",
                            "name": "珊瑚柚"
                        },
                        {
                            "id": "12",
                            "color": "#AD625E",
                            "name": "摩卡色"
                        }
                    ]
                },
                {
                    "name": "莹亮灿金唇彩",
                    "lipsticks": [
                        {
                            "id": "49",
                            "color": "#D03370",
                            "name": "骚动"
                        },
                        {
                            "id": "207",
                            "color": "#D11746",
                            "name": "激情"
                        },
                        {
                            "id": "03",
                            "color": "#D34E59",
                            "name": "憧憬"
                        },
                        {
                            "id": "15",
                            "color": "#AB3B48",
                            "name": "突然"
                        },
                        {
                            "id": "30",
                            "color": "#DD6053",
                            "name": "甜蜜"
                        },
                        {
                            "id": "203",
                            "color": "#FE645A",
                            "name": "心跳"
                        },
                        {
                            "id": "204",
                            "color": "#FE5B56",
                            "name": "意外"
                        },
                        {
                            "id": "206",
                            "color": "#B80722",
                            "name": "炙热"
                        }
                    ]
                }
            ]
        },
        {
            "name": "香奈儿可可小姐",
            "series": [
                {
                    "name": "唇膏水亮",
                    "lipsticks": [
                        {
                            "id": "69",
                            "color": "#F17365",
                            "name": "传情"
                        },
                        {
                            "id": "46",
                            "color": "#E87268",
                            "name": "自由"
                        },
                        {
                            "id": "122",
                            "color": "#EA4D4A",
                            "name": "CORAIL RADIEUX"
                        },
                        {
                            "id": "97",
                            "color": "#D53D49",
                            "name": "洒脱"
                        },
                        {
                            "id": "44",
                            "color": "#FD4334",
                            "name": "水漾纱丽"
                        },
                        {
                            "id": "507",
                            "color": "#E94648",
                            "name": "倔强"
                        },
                        {
                            "id": "114",
                            "color": "#FF3220",
                            "name": "SHIPSHAPE"
                        },
                        {
                            "id": "91",
                            "color": "#C12A33",
                            "name": "波希米亚"
                        },
                        {
                            "id": "84",
                            "color": "#CE1220",
                            "name": "对白"
                        },
                        {
                            "id": "57",
                            "color": "#EB6F79",
                            "name": "冒险"
                        },
                        {
                            "id": "116",
                            "color": "#EC5193",
                            "name": "MIGHTY"
                        },
                        {
                            "id": "54",
                            "color": "#D1918D",
                            "name": "卡柏男孩"
                        },
                        {
                            "id": "79",
                            "color": "#E86A75",
                            "name": "传奇"
                        },
                        {
                            "id": "497",
                            "color": "#ED5A5E",
                            "name": "勇敢"
                        },
                        {
                            "id": "132",
                            "color": "#E93A5B",
                            "name": "ROSE RAVISSANT"
                        },
                        {
                            "id": "87",
                            "color": "#F8657F",
                            "name": "约会"
                        },
                        {
                            "id": "55",
                            "color": "#F14C77",
                            "name": "浪漫爱情"
                        },
                        {
                            "id": "118",
                            "color": "#EB2755",
                            "name": "ENERGY"
                        },
                        {
                            "id": "62",
                            "color": "#E12948",
                            "name": "蒙特卡罗"
                        },
                        {
                            "id": "134",
                            "color": "#E7394A",
                            "name": "RENOUVEAU"
                        },
                        {
                            "id": "98",
                            "color": "#CC4D68",
                            "name": "率真"
                        },
                        {
                            "id": "60",
                            "color": "#BB395F",
                            "name": "安蒂岗妮"
                        },
                        {
                            "id": "61",
                            "color": "#C54463",
                            "name": "幸福时光"
                        }
                    ]
                },
                {
                    "name": "炫亮魅力唇膏",
                    "lipsticks": [
                        {
                            "id": "90",
                            "color": "#FC6E48",
                            "name": "活泼"
                        },
                        {
                            "id": "96",
                            "color": "#FA421C",
                            "name": "古灵精怪"
                        },
                        {
                            "id": "182",
                            "color": "#E02E20",
                            "name": "VIBRANTE"
                        },
                        {
                            "id": "152",
                            "color": "#E82F2C",
                            "name": "隐约"
                        },
                        {
                            "id": "172",
                            "color": "#E40021",
                            "name": "ROUGE REBELLE"
                        },
                        {
                            "id": "135",
                            "color": "#99413D",
                            "name": "谜情"
                        },
                        {
                            "id": "99",
                            "color": "#8A010D",
                            "name": "海盗"
                        },
                        {
                            "id": "176",
                            "color": "#A80D1F",
                            "name": "INDÉPENDANTE"
                        },
                        {
                            "id": "169",
                            "color": "#8E2622",
                            "name": "ROUGE TENTATION"
                        },
                        {
                            "id": "91",
                            "color": "#E45661",
                            "name": "吸引力"
                        },
                        {
                            "id": "179",
                            "color": "#ED6160",
                            "name": "LUMINOUS"
                        },
                        {
                            "id": "94",
                            "color": "#FC3E6E",
                            "name": "着迷"
                        },
                        {
                            "id": "138",
                            "color": "#D93E5E",
                            "name": "激昂"
                        },
                        {
                            "id": "136",
                            "color": "#EF4246",
                            "name": "悠扬"
                        },
                        {
                            "id": "178",
                            "color": "#BF5363",
                            "name": "NEW PRODIGIOUS"
                        },
                        {
                            "id": "158",
                            "color": "#B24957",
                            "name": "VIREVOLTANTE"
                        },
                        {
                            "id": "93",
                            "color": "#CD0043",
                            "name": "兴奋"
                        },
                        {
                            "id": "165",
                            "color": "#C82C40",
                            "name": "ÉBLOUISSANTE"
                        },
                        {
                            "id": "184",
                            "color": "#C80F2E",
                            "name": "INCANTEVOLE"
                        },
                        {
                            "id": "102",
                            "color": "#B20032",
                            "name": "悸动"
                        }
                    ]
                },
                {
                    "name": "炫亮魅力唇膏",
                    "lipsticks": [
                        {
                            "id": "90",
                            "color": "#E1527E",
                            "name": "IMAGINATION"
                        }
                    ]
                },
                {
                    "name": "炫亮魅力唇膏丝绒",
                    "lipsticks": [
                        {
                            "id": "65",
                            "color": "#E17062",
                            "name": "L'ARISTOCRATICA"
                        },
                        {
                            "id": "64",
                            "color": "#E84632",
                            "name": "FIRST LIGHT"
                        },
                        {
                            "id": "57",
                            "color": "#BE2B24",
                            "name": "ROUGE FEU"
                        },
                        {
                            "id": "66",
                            "color": "#E1112A",
                            "name": "L'INDOMABILE"
                        },
                        {
                            "id": "51",
                            "color": "#9E333D",
                            "name": "震撼"
                        },
                        {
                            "id": "56",
                            "color": "#B23030",
                            "name": "ROUGE CHARNEL"
                        },
                        {
                            "id": "38",
                            "color": "#892833",
                            "name": "迷惑"
                        },
                        {
                            "id": "58",
                            "color": "#822E2E",
                            "name": "ROUGE VIE"
                        },
                        {
                            "id": "63",
                            "color": "#802932",
                            "name": "NIGHTFALL"
                        },
                        {
                            "id": "61",
                            "color": "#EC7879",
                            "name": "LA SECRÈTE"
                        },
                        {
                            "id": "42",
                            "color": "#FE697F",
                            "name": "显眼"
                        },
                        {
                            "id": "43",
                            "color": "#FA5059",
                            "name": "亲爱"
                        },
                        {
                            "id": "46",
                            "color": "#C92D38",
                            "name": "慧黠"
                        },
                        {
                            "id": "37",
                            "color": "#C43759",
                            "name": "纵情"
                        },
                        {
                            "id": "44",
                            "color": "#F06FA5",
                            "name": "歌剧名伶"
                        },
                        {
                            "id": "50",
                            "color": "#9F2F56",
                            "name": "浪漫幻想"
                        }
                    ]
                }
            ]
        },
        {
            "name": "迪奥",
            "series": [
                {
                    "name": "魅惑釉唇膏",
                    "lipsticks": [
                        {
                            "id": "457",
                            "color": "#EB636B",
                            "name": "鸡尾酒"
                        },
                        {
                            "id": "487",
                            "color": "#EB5C97",
                            "name": "泡泡堂"
                        },
                        {
                            "id": "550",
                            "color": "#E47082",
                            "name": "小心计"
                        },
                        {
                            "id": "554",
                            "color": "#EA5344",
                            "name": "日光浴"
                        },
                        {
                            "id": "564",
                            "color": "#E94858",
                            "name": "购物狂"
                        },
                        {
                            "id": "577",
                            "color": "#C86378",
                            "name": "混日子"
                        },
                        {
                            "id": "637",
                            "color": "#E74218",
                            "name": "热点"
                        },
                        {
                            "id": "644",
                            "color": "#EA5331",
                            "name": "生存游戏"
                        },
                        {
                            "id": "684",
                            "color": "#E60860",
                            "name": "人生赢家"
                        },
                        {
                            "id": "740",
                            "color": "#902216",
                            "name": "可乐部"
                        },
                        {
                            "id": "744",
                            "color": "#E51E1B",
                            "name": "花蝴蝶"
                        },
                        {
                            "id": "794",
                            "color": "#95358C",
                            "name": "天生玩家"
                        },
                        {
                            "id": "857",
                            "color": "#A01314",
                            "name": "好莱坞大咖"
                        },
                        {
                            "id": "867",
                            "color": "#901A32",
                            "name": "红酒"
                        },
                        {
                            "id": "877",
                            "color": "#C4032B",
                            "name": "给我迪奥"
                        },
                        {
                            "id": "882",
                            "color": "#BB0E63",
                            "name": "野蛮女友"
                        },
                        {
                            "id": "904",
                            "color": "#391E1D",
                            "name": "黑咖啡"
                        },
                        {
                            "id": "924",
                            "color": "#602227",
                            "name": "不羁"
                        }
                    ]
                },
                {
                    "name": "魅惑染唇蜜",
                    "lipsticks": [
                        {
                            "id": "351",
                            "color": "#D8707D",
                            "name": "魅惑染唇蜜"
                        },
                        {
                            "id": "421",
                            "color": "#AD5F56",
                            "name": "魅惑染唇蜜"
                        },
                        {
                            "id": "451",
                            "color": "#E55461",
                            "name": "Natural Coral"
                        },
                        {
                            "id": "491",
                            "color": "#A76165",
                            "name": "魅惑染唇蜜"
                        },
                        {
                            "id": "761",
                            "color": "#E13D5D",
                            "name": "Natural Cherry"
                        },
                        {
                            "id": "771",
                            "color": "#974249",
                            "name": "Natural Berry"
                        },
                        {
                            "id": "881",
                            "color": "#EC6292",
                            "name": "Natural Pink"
                        }
                    ]
                },
                {
                    "name": "烈艳蓝金唇膏",
                    "lipsticks": [
                        {
                            "id": "028",
                            "color": "#E83F4A",
                            "name": "Actrice"
                        },
                        {
                            "id": "426",
                            "color": "#D58F7F",
                            "name": ""
                        },
                        {
                            "id": "481",
                            "color": "#B76566",
                            "name": ""
                        },
                        {
                            "id": "047",
                            "color": "#E40068",
                            "name": "迪奥小姐"
                        },
                        {
                            "id": "781",
                            "color": "#833B43",
                            "name": ""
                        },
                        {
                            "id": "060",
                            "color": "#D36179",
                            "name": "首映礼"
                        },
                        {
                            "id": "080",
                            "color": "#D91820",
                            "name": "微笑正红"
                        },
                        {
                            "id": "861",
                            "color": "#B52237",
                            "name": ""
                        },
                        {
                            "id": "996",
                            "color": "#BD7376",
                            "name": ""
                        },
                        {
                            "id": "999",
                            "color": "#A82628",
                            "name": ""
                        },
                        {
                            "id": "999",
                            "color": "#A82628",
                            "name": "Metallic"
                        },
                        {
                            "id": "207",
                            "color": "#BBC3C2",
                            "name": "蒙田灰"
                        },
                        {
                            "id": "277",
                            "color": "#DB7096",
                            "name": "Osée"
                        },
                        {
                            "id": "343",
                            "color": "#EF7C6B",
                            "name": "Panaréa"
                        },
                        {
                            "id": "351",
                            "color": "#E46177",
                            "name": "Dansante"
                        },
                        {
                            "id": "459",
                            "color": "#D1546E",
                            "name": "Charnelle"
                        },
                        {
                            "id": "520",
                            "color": "#E4003E",
                            "name": "Feel Good"
                        },
                        {
                            "id": "553",
                            "color": "#DA4F4E",
                            "name": "Sillage"
                        },
                        {
                            "id": "567",
                            "color": "#EA5069",
                            "name": "Rose en Dior"
                        },
                        {
                            "id": "576",
                            "color": "#F08182",
                            "name": "Pretty Matte"
                        },
                        {
                            "id": "602",
                            "color": "#2E4763",
                            "name": "狂想"
                        },
                        {
                            "id": "642",
                            "color": "#EA5155",
                            "name": "Ready"
                        },
                        {
                            "id": "643",
                            "color": "#E84617",
                            "name": "Stand Out"
                        },
                        {
                            "id": "652",
                            "color": "#ED6C7F",
                            "name": "珊瑚"
                        },
                        {
                            "id": "663",
                            "color": "#D0546B",
                            "name": "Désir"
                        },
                        {
                            "id": "665",
                            "color": "#BD5154",
                            "name": "Rêvée"
                        },
                        {
                            "id": "678",
                            "color": "#CC4A6B",
                            "name": "Culte"
                        },
                        {
                            "id": "746",
                            "color": "#DC002C",
                            "name": "Favorite"
                        },
                        {
                            "id": "756",
                            "color": "#E52F31",
                            "name": "Panache"
                        },
                        {
                            "id": "766",
                            "color": "#CF1D59",
                            "name": "Rose Harpers"
                        },
                        {
                            "id": "771",
                            "color": "#E96C81",
                            "name": "Radiant Matte"
                        },
                        {
                            "id": "772",
                            "color": "#CB7A84",
                            "name": "Classic Matte"
                        },
                        {
                            "id": "775",
                            "color": "#E1244B",
                            "name": "Hyde Park"
                        },
                        {
                            "id": "787",
                            "color": "#E6699D",
                            "name": "Exuberant Matte"
                        },
                        {
                            "id": "789",
                            "color": "#96518F",
                            "name": "痴迷"
                        },
                        {
                            "id": "844",
                            "color": "#E0262E",
                            "name": "Trafalgar"
                        },
                        {
                            "id": "856",
                            "color": "#B62631",
                            "name": "Célèbre"
                        },
                        {
                            "id": "888",
                            "color": "#EB5958",
                            "name": "Strong Matte"
                        },
                        {
                            "id": "962",
                            "color": "#86556D",
                            "name": "奇葩"
                        },
                        {
                            "id": "999",
                            "color": "#BE020D",
                            "name": ""
                        },
                        {
                            "id": "999",
                            "color": "#CC434D",
                            "name": "传奇红唇哑光"
                        }
                    ]
                }
            ]
        },
        {
            "name": "美宝莲",
            "series": [
                {
                    "name": "绝色持久唇膏绒情哑光",
                    "lipsticks": [
                        {
                            "id": "MAT5",
                            "color": "#99163A",
                            "name": ""
                        },
                        {
                            "id": "R45M",
                            "color": "#A22040",
                            "name": ""
                        },
                        {
                            "id": "R41M",
                            "color": "#C31431",
                            "name": "COLOR SENSATIONAL VIVID MATTE"
                        },
                        {
                            "id": "MAT1",
                            "color": "#EC5C80",
                            "name": ""
                        },
                        {
                            "id": "MAT3",
                            "color": "#EC594F",
                            "name": ""
                        },
                        {
                            "id": "MAT5",
                            "color": "#F193AD",
                            "name": ""
                        }
                    ]
                }
            ]
        },
        {
            "name": "纪梵希",
            "series": [
                {
                    "name": "高定香榭天鹅绒唇膏（小羊皮）",
                    "lipsticks": [
                        {
                            "id": "N103",
                            "color": "#DF695F",
                            "name": "优雅米色"
                        },
                        {
                            "id": "N103",
                            "color": "#C74A52",
                            "name": "迷人茶色"
                        },
                        {
                            "id": "N105",
                            "color": "#A82A40",
                            "name": "阳光小麦"
                        },
                        {
                            "id": "N202",
                            "color": "#F43556",
                            "name": "幻想玫瑰"
                        },
                        {
                            "id": "N204",
                            "color": "#BE2446",
                            "name": "樱桃玫瑰"
                        },
                        {
                            "id": "N205",
                            "color": "#E70060",
                            "name": "加仑玫瑰"
                        },
                        {
                            "id": "N304",
                            "color": "#F82131",
                            "name": "加州红"
                        },
                        {
                            "id": "N306",
                            "color": "#E50036",
                            "name": "法式红"
                        },
                        {
                            "id": "N303",
                            "color": "#FA054B",
                            "name": "珊瑚红"
                        },
                        {
                            "id": "N302",
                            "color": "#FB2C60",
                            "name": "芭比红"
                        },
                        {
                            "id": "305",
                            "color": "#FA013D",
                            "name": "缪斯红"
                        },
                        {
                            "id": "201",
                            "color": "#FA6173",
                            "name": "糖果玫瑰"
                        },
                        {
                            "id": "209",
                            "color": "#F60071",
                            "name": "明艳玫瑰"
                        },
                        {
                            "id": "210",
                            "color": "#FF4D89",
                            "name": "大丽玫瑰"
                        },
                        {
                            "id": "315",
                            "color": "#AC003A",
                            "name": "覆盆子红"
                        },
                        {
                            "id": "317",
                            "color": "#E03B35",
                            "name": "暖柿红"
                        },
                        {
                            "id": "307",
                            "color": "#93142F",
                            "name": "石榴红"
                        },
                        {
                            "id": "301",
                            "color": "#DF3751",
                            "name": "西瓜红"
                        },
                        {
                            "id": "214",
                            "color": "#BB3C5A",
                            "name": "复古玫瑰"
                        },
                        {
                            "id": "323",
                            "color": "#C53057",
                            "name": "高雅梅"
                        },
                        {
                            "id": "326",
                            "color": "#932844",
                            "name": "勃艮第红"
                        },
                        {
                            "id": "327",
                            "color": "#9B325A",
                            "name": "莓紫红"
                        },
                        {
                            "id": "324",
                            "color": "#EE4650",
                            "name": "秀场红"
                        },
                        {
                            "id": "325",
                            "color": "#E11020",
                            "name": "圣水红"
                        },
                        {
                            "id": "215",
                            "color": "#844452",
                            "name": "橡皮裸肌"
                        },
                        {
                            "id": "329",
                            "color": "#731919",
                            "name": "红色高跟鞋"
                        },
                        {
                            "id": "330",
                            "color": "#64263F",
                            "name": "复古提琴"
                        },
                        {
                            "id": "331",
                            "color": "#58151E",
                            "name": "赤霞珠"
                        }
                    ]
                },
                {
                    "name": "禁忌之吻霓虹唇膏",
                    "lipsticks": [
                        {
                            "id": "11",
                            "color": "#BA353C",
                            "name": "御姐橘"
                        },
                        {
                            "id": "7",
                            "color": "#8B2844",
                            "name": "幻想紫"
                        },
                        {
                            "id": "8",
                            "color": "#B12252",
                            "name": "暗夜莓"
                        },
                        {
                            "id": "9",
                            "color": "#DD485B",
                            "name": "沉睡红"
                        },
                        {
                            "id": "10",
                            "color": "#B53D52",
                            "name": "帅T红"
                        },
                        {
                            "id": "12",
                            "color": "#B9282D",
                            "name": "女巫红"
                        },
                        {
                            "id": "13",
                            "color": "#CA292E",
                            "name": "禁忌红"
                        },
                        {
                            "id": "14",
                            "color": "#CB2D21",
                            "name": "鬼魅红"
                        },
                        {
                            "id": "15",
                            "color": "#D43A29",
                            "name": "夜光橘"
                        },
                        {
                            "id": "16",
                            "color": "#DF4541",
                            "name": "潮女红"
                        },
                        {
                            "id": "18",
                            "color": "#D35C5E",
                            "name": "童话粉"
                        },
                        {
                            "id": "22",
                            "color": "#EC2663",
                            "name": "精灵粉"
                        },
                        {
                            "id": "23",
                            "color": "#C62E54",
                            "name": "魔女粉"
                        },
                        {
                            "id": "24",
                            "color": "#AA2260",
                            "name": "傲娇粉"
                        },
                        {
                            "id": "17",
                            "color": "#DD5852",
                            "name": "乙女粉"
                        },
                        {
                            "id": "19",
                            "color": "#E36476",
                            "name": "治愈粉"
                        },
                        {
                            "id": "20",
                            "color": "#EC6284",
                            "name": "萝莉粉"
                        },
                        {
                            "id": "21",
                            "color": "#EA586F",
                            "name": "元气粉"
                        }
                    ]
                }
            ]
        }
    ]
        </script>
        <script>
            // https://bcw-media.s3.ap-northeast-1.amazonaws.com/B2_B_virtual_Makeup_topbanner_video_dt_v2_bcc9afbf3b.mp4
            new Vue({
                el: '#app',
                data: {
                    camera: null,
                    width: document.documentElement.clientWidth || window.innerWidth,
                    height: document.documentElement.clientHeight || window.innerHeight,
                    canvasWidth: 0,
                    canvasHeight: 0,
                    deviceList: [], //设备列表
                    isCameraOpen: false, //摄像头是否打开
                    task: null, //任务
                    model: null, //模型
                    modelLoad: true, //模型加载中
                    gui: null,
                    brands,
                    controls: {
                        deviceId: localStorage.getItem(`deviceId`) || 'user', //设备id
                        flipHorizontal: false, // 是否水平翻转
                        lipsColor: '#d4020e',
                        lipsOpacity: 0.9,
                        eyelash: true,//睫毛
                    },
                    lipsColorId:"",
                    canvas: null,
                    ctx: null
                },
                mounted() {
                    if((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))){
                        this.controls.flipHorizontal = true;
                    }
                    this.canvas = this.$refs.canvas;
                    this.ctx = this.canvas.getContext('2d');
                    this.$refs.previewVideo.srcObject = this.canvas.captureStream(25);
                    this.$refs.previewVideo.play();

                    this.$dialog.alert({
                        message: `
                        <div class="prompt-text">
                            <h5>AR口红试色</h5>
                            <ol>
                                <li>首次模型加载模型可能需要1-2分钟，请耐心等待</li>
                                <li>需要打开摄像头，（不会把您的摄像头信息上传到服务端）</li>
                                <li>打开摄像头后如发现摄像头是镜像，可点击“切换镜像”。</li>
                            </ol>
                        </div>`,
                        theme: 'round-button',
                        className: 'helpdialog',
                        confirmButtonText: '开始吧'
                    })
                    .then(() => {
                        this.cameraInit();
                        this.openCamera();
                    })
                },
                methods: {
                    isObjEmpty(obj) {
                        return (
                            obj === undefined ||
                            obj === "undefined" ||
                            obj == null ||
                            obj === "" ||
                            obj.length === 0 ||
                            (typeof obj === "object" && Object.keys(obj).length === 0)
                        );
                    },
                    setColor(item,seriesItem,lipsticksItem){
                        this.lipsColorId = lipsticksItem.id;
                        this.controls.lipsColor = lipsticksItem.color;
                        this.$notify({ type: 'primary', message: `${item.name}-${seriesItem.name}-${lipsticksItem.name}`});
                    },
                    actionSelect() {
                        localStorage.setItem(`deviceId`, this.controls.deviceId);
                        this.openCamera();
                    },
                    async getMediaDevices() {
                        let deviceList = await this.camera.getMediaDevices();
                        this.deviceList = deviceList.map(e => {
                            e.name = e.label || e.deviceId;
                            e.color = e.deviceId == this.deviceId ? '#1989fa' : '#323233';
                            return e
                        })
                    },
                    async cameraInit() {
                        const video = this.$refs.video;
                        this.camera = new Camera(video, {
                            audio: false,
                            video: {
                                // width: this.width,
                                // height: this.height,
                            }
                        });
                        await this.getMediaDevices();
                    },
                    openCamera() {
                        const toast = this.$toast.loading({
                            duration: 0, // 持续展示 toast
                            forbidClick: true,
                            message: '打开摄像头',
                        });
                        this.isCameraOpen = false;
                        this.camera.open(this.controls.deviceId)
                            .then(async res => {
                                const video = this.$refs.video;
                                const { videoWidth, videoHeight } = video;
                                const { clientWidth, clientHeight } = video;
                                this.canvasWidth = videoWidth;
                                this.canvasHeight = videoHeight;
                                video.width = videoWidth;
                                video.height = videoHeight;
                                this.$refs.wrapper.style.width = clientWidth + 'px';
                                this.$refs.wrapper.style.height = clientHeight + 'px';
                                this.isCameraOpen = true;
                                if (res.settings && res.settings.deviceId) {
                                    this.controls.deviceId = res.settings.deviceId;
                                    if (this.deviceList.filter(e => e.deviceId == this.controls.deviceId).length === 0) {
                                        this.deviceList.unshift({
                                            name: res.label || '[未知设备]',
                                            deviceId: this.controls.deviceId
                                        })
                                    }
                                    window.localStorage.setItem(`deviceId`, this.controls.deviceId);
                                };
                                await this.createModel();
                                window.cancelAnimationFrame(this.task);
                                this.task = window.requestAnimationFrame(this.recognition);
                            })
                            .catch(error => {
                                console.log('error',error);
                                this.$dialog.alert({
                                    title: '失败',
                                    message: `打开摄像头失败：${error.errMsg}`,
                                    theme: 'round-button',
                                }).then(() => {

                                });
                            })
                            .finally(() => {
                                toast.clear();
                            })
                    },
                    //创建模型
                    createModel() {
                        return new Promise(async resolve => {
                            this.modelLoad = true;
                            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                            const toast = this.$toast.loading({
                                duration: 0, // 持续展示 toast
                                forbidClick: true,
                                message: '加载模型中',
                            });
                            await tf.setBackend('webgl')
                            const model = faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh;
                            const detectorConfig = {
                                maxFaces: 1, //检测到的最大面部数量
                                refineLandmarks: true, //可以完善眼睛和嘴唇周围的地标坐标，并在虹膜周围输出其他地标
                                runtime: 'mediapipe',
                                solutionPath: 'https://unpkg.com/@mediapipe/face_mesh', //WASM二进制文件和模型文件所在的路径
                            };
                            this.model = await faceLandmarksDetection.createDetector(model, detectorConfig);
                            toast.clear();
                            this.modelLoad = false;
                            resolve(this.model);
                        })
                    },
                    //识别
                    async recognition() {
                        try {
                            if (this.isCameraOpen && !this.modelLoad) {
                                const video = this.$refs.video;
                                const faces = await this.model.estimateFaces(video, {
                                    flipHorizontal: this.controls.flipHorizontal, //镜像
                                });
                                this.drawResults(faces, video); //绘制
                            };
                            this.task = window.requestAnimationFrame(this.recognition);
                        } catch (error) {
                            console.log(error);
                            this.task = window.requestAnimationFrame(this.recognition);
                        }
                    },
                    drawResults(faces, video) {
                        this.ctx.save();
                        const { width, height } = this.canvas;
                        const { flipHorizontal } = this.controls;
                        this.ctx.clearRect(0, 0, width, height);
                        this.ctx.drawImage(video, 0, 0, this.canvas.width, height);
                        if (flipHorizontal) {
                            var imgData = this.ctx.getImageData(0, 0, width, height);
                            var newImgData = this.ctx.getImageData(0, 0, width, height);
                            this.ctx.clearRect(0, 0, width, height);
                            this.ctx.putImageData(this.imageDataHRevert(newImgData, imgData), 0, 0);//左右翻转
                        };
                        faces.forEach(faceItem => {
                            const keypoints = (faceItem.keypoints || []);
                            this.setLipsColor(keypoints); //绘制嘴
                        })
                        this.ctx.restore();
                    },
                    //设置嘴的颜色
                    setLipsColor(keypoints) {
                        const { lipsColor, lipsOpacity } = this.controls;
                        const bottom_lips = [61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291, 292, 308, 324, 318, 402, 317, 14, 87, 178, 88, 95, 78, 62, 61];//下
                        const top_lips = [61, 185, 40, 39, 37, 0, 267, 269, 270, 409, 291, 292, 308, 415, 310, 311, 312, 13, 82, 81, 80, 191, 78, 62, 61];//上
                        const color = this.toRGBA(lipsColor, lipsOpacity)
                        const bottom_points = bottom_lips.map(idx => keypoints[idx]);
                        this.drawLine(bottom_points, 1, color, true);
                        const top_points = top_lips.map(idx => keypoints[idx]);
                        this.drawLine(top_points, 1, color, true);
                    },
                    //画线
                    drawLine(lineArr = [], lineWidth = 2, color = "lime", isFill = false) {
                        this.ctx.beginPath();
                        this.ctx.lineCap = "round";
                        this.ctx.lineJoin = "round";
                        this.ctx.strokeStyle = color;
                        this.ctx.lineWidth = lineWidth;
                        lineArr.forEach((e, index) => {
                            if (index > 0) {
                                this.ctx.lineTo(e.x, e.y);
                            } else {
                                this.ctx.moveTo(e.x, e.y);
                            }
                        });
                        this.ctx.stroke();
                        this.ctx.closePath();
                        if (isFill) {
                            this.ctx.fillStyle = color;
                            this.ctx.fill();
                        }
                    },
                    //横向像素反转
                    imageDataHRevert(sourceData, newData) {
                        var h;
                        for (var i = 0, h = sourceData.height; i < h; i++) {
                            var j = 0;
                            var w;
                            for (j = 0, w = sourceData.width; j < w; j++) {
                                newData.data[i * w * 4 + j * 4 + 0] = sourceData.data[i * w * 4 + (w - j) * 4 + 0];
                                newData.data[i * w * 4 + j * 4 + 1] = sourceData.data[i * w * 4 + (w - j) * 4 + 1];
                                newData.data[i * w * 4 + j * 4 + 2] = sourceData.data[i * w * 4 + (w - j) * 4 + 2];
                                newData.data[i * w * 4 + j * 4 + 3] = sourceData.data[i * w * 4 + (w - j) * 4 + 3];
                            }
                        }
                        return newData;
                    },
                    toRGBA(str, opacity) {
                        // 16进制颜色值的正则
                        var reg = /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;
                        // 把颜色值变成小写
                        var color = str.toLowerCase();
                        if (reg.test(color)) {
                            // 如果只有三位的值，需变成六位，如：#fff => #ffffff
                            if (color.length === 4) {
                                var colorNew = "#";
                                for (var i = 1; i < 4; i += 1) {
                                    colorNew += color.slice(i, i + 1).concat(color.slice(i, i + 1));
                                }
                                color = colorNew;
                            }
                            // 处理六位的颜色值，转为RGB
                            var rgbc = [];
                            for (var i = 1; i < 7; i += 2) {
                                rgbc.push(parseInt("0x" + color.slice(i, i + 2)));
                            }
                            //floor 向下取整
                            for (var i = 0; i < 3; i++) rgbc[i] = Math.floor(rgbc[i] * (1 - 0.1));
                            return `rgba(${rgbc[0]},${rgbc[1]},${rgbc[2]},${opacity})`
                        } else {
                            return color;
                        }
                    },
                    downloadImg(){
                        const a = document.createElement('a');
                        a.href = this.canvas.toDataURL('image/png');
                        a.download = `${this.controls.lipsColor}_${new Date().getTime()}.png`;
                        const event = new MouseEvent('click');
                        a.dispatchEvent(event);
                    },
                    async share() {
                        this.$toast.loading({
                            duration: 0, // 持续展示 toast
                            forbidClick: true,
                            message: '分享中',
                        });
                        try {
                            const shareIcon = this.canvas.toDataURL('image/png')
                            const { host, search, href } = location;
                            const { projectId } = Object.fromEntries(new URLSearchParams(search));
                            const files = [this.Base64UrlToBlob(shareIcon,'image/jpeg','icon.jpeg')];
                            console.log('files',files);
                            navigator.share({
                                url: host === "code.devrank.cn" ? `https://code.juejin.cn/pen/${projectId}` : href,
                                title: `我在玩《AR口红试色》，快来加入吧`,
                                text: `我在玩《AR口红试色》，快来加入吧`,
                                files
                            }).then(res => {
                                this.$toast('分享成功')
                            }).catch(err=>{
                                this.$toast('分享失败-'+err)
                            })
                        } catch (error) {
                            console.error(error);
                            this.$toast('分享失败')
                        }
                    },
                    Base64UrlToBlob(base64,type="image/png",filename="icon.png") {
                         // 获取到base64编码
                        const base64_str = base64.split(',');
                        // 将base64编码转为字符串
                        const decode_str = atob(base64_str[1]);
                        let n = decode_str.length;
                        // 创建初始化为0的，包含length个元素的无符号整型数组
                        const u8arr = new Uint8Array(n) ;
                        while (n--) {
                            u8arr[n] = decode_str .charCodeAt(n);
                        }
                        return new File([u8arr], filename, {
                            type,
                        });
                    },
                },
            });
        </script>
    </body>

</html>